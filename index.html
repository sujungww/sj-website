<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SJ-Website</title>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: url(./background.jpg);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 32px;
      gap: 20px;
    }

    .frame {
      width: min(1750px, 100%);
      min-height: calc(100vh - 64px);
      background: #fff;
      padding: 16px;

      grid-template-columns: 3fr 1fr;
      display: grid;
      gap: 20px;

      overflow: hidden;
    }

    .main-area{
      border: 1px solid rgb(197, 197, 197);
      padding: 16px;

      display: grid;
      grid-template-columns: 340px 1fr;
      row-gap: 16px;

      align-content: start;
    }
    .guest-area{
      border: 1px solid rgb(197, 197, 197);
      padding: 16px;
      overflow: hidden;

      display: flex;
      min-height: 0;
    }
    @media (max-width: 768px) {
      body { padding: 12px; align-items: flex-start; }

      .frame{
        height: auto;
        max-height: none;
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
        width: 100%;
        max-width: 1750px;
      }
    }

    .profile-box {
      width: 100%;
      max-width: 340px;
      border: 1px solid rgb(197,197,197);
      padding: 20px;
      margin: 0;

      grid-column: 1;
    }

    .timetable-box{
      width: 100%;
      max-width: 340px;
      border: 1px solid rgb(197,197,197);
      padding: 20px;
      margin: 0;
      text-align: center;

      grid-column: 1;
    }

    .profile-img {
      width: 100%;
      height: auto;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 12px;
      display: block;
      margin: 0 auto 14px;
    }

    .timetable-img{
      width: 100%;
      max-height: 260px;
      height: auto;
      object-fit: contain;
      border-radius: 12px;
      display: block;
      margin: 0 0 14px;
    }
    .introduction-box{ grid-column:2; }

    .links-box{
      border: 1px solid rgb(197, 197, 197);
      padding: 16px;
      margin-top: 16px;

      grid-column: 2;
    }
    .links-box h3{
      margin: 0 0 12px;
      font-size: 16px;
    }
    .links-grid{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .link-btn{
      display: block;
      border: 1px solid #ccc;
      padding: 12px;
      text-decoration: none;
      color: #111;
      background: #fff;

      width: 100px;
      margin: 0 auto;
      text-align: center;

      transition: all 0.15s ease;
    }

    .link-btn:hover{
      background:#f5f5f5;
    }

    .link-btn:active{
      transform: scale(0.92);
      background:#eaeaea;
    }
    .memo-box{
      padding: 14px;                 /* 16~20 ‚Üí 14 */
    }
    .memo-box textarea{
      width: 100%;
      min-height: 220px;
      resize: vertical;
      border: 1px solid #ccc;
      padding: 12px;
      font-family: inherit;
      border-radius: 10px;
      background: #fff;
    }

    .content-box {
      flex: 1;
      border: 1px solid rgb(197,197,197);
      padding: 20px;
      box-sizing: border-box;
      background-image: url(./8921B8CA-8C79-4843-904E-16DF46D2E9EB_1_201_a.jpeg);

      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;

      height: 600px;
    }

    .guestbook-form {
      display: grid;
      gap: 10px;
      margin-bottom: 16px;
    }

    .guestbook-form input,
    .guestbook-form textarea {
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 14px;
      
      font-family: inherit;
    }

    .guestbook-form textarea {
      min-height: 90px;
    }

    .guestbook-form button {
      width: 120px;
      padding: 10px;
      cursor: pointer;
    }

    .guestbook-list {
      display: grid;
      gap: 10px;

      flex: 1;
      overflow-y: auto;
      gap: 10px;
      min-height: 0;
      padding-right: 6px;
    }

    .gb-item {
      border: 1px solid #ddd;
      padding: 12px;
    }

    .gb-meta {
      font-size: 12px;
      color: #fff;
      margin-bottom: 6px;
    }
    .gb-message{
      color:#fff;
    }
    .heart-box{
      border: 1px solid rgb(197,197,197);
      padding: 16px;
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .heart-box h3{
      margin: 0;
      font-size: 16px;
      margin-right: auto;

      grid-column: 2;
    }

    #heart-btn{
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 18px;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    #heart-btn:active{
      transform: scale(0.92);
    }
    #heart-count{
      font-weight: 700;
      font-size: 16px;
      min-width: 24px;
      text-align: left;
    }
  </style>
</head>

<body>

<div class="frame">
  <section class="main-area">
    <div class="profile-box">

      <img src="./IMG_5995.jpeg" class="profile-img">
      <h2>Sujung</h2>
      <p>Webpage testing Lab</p>

      <section class="heart-box">
        <h3>ÌïòÌä∏ ÎàåÎü¨Î≥¥ÏÑ∏Ïó¨~</h3>
        <button id="heart-btn" type="button" aria-label="heart">‚ù§Ô∏è</button>
        <span id="heart-count">0</span>
      </section>

    </div>

    <section class="links-box">
      <div class="links-grid">
        <a class="link-btn" href="https://github.com/sujungww" target="_blank" rel="noopener">GitHub</a>
        <a class="link-btn" href="https://music.apple.com/profile/muniverse" target="_blank" rel="noopener">AppleMusic</a>
        <a class="link-btn" href="https://www.instagram.com/enyvarse?igsh=Z2tjZHpwZXlqZnBh&utm_source=qr" target="_blank" rel="noopener">Insta</a>
        <a class="link-btn" href="https://blog.naver.com/sujung1ch" target="_blank" rel="noopener">Blog</a>
      </div>
    </section>

    <div class="timetable-box">
      <img src="./IMG_6150.jpeg" class="timetable-img">
    </div>

    <section class="introduction-box">
      <textarea id="memo" placeholder="Ïó¨Í∏∞Ïóê Î©îÎ™®Ìï¥ÎëêÍ∏∞..."></textarea>
    </section>



  </section>

  <section class="guest-area">
    <div class="content-box">
  
      <h2>Î¨¥Ï°∞Í±¥ ÏÑ†ÌîåÎßå üòç</h2>
  
      <form id="guestbook-form" class="guestbook-form">
        <input id="gb-name" type="text" maxlength="20" placeholder="Ï†ú Ïù¥Î¶ÑÏùÄÏó¨~" required>
        <textarea id="gb-message" maxlength="200" placeholder="ÏàòÏ†ïÏù¥ÏóêÍ≤å Ìï† Îßê!" required></textarea>
        <button type="submit">Ïó≠ÏÇ¨Ïóê Í∏∞Î°ù ÎÇ®Í∏∞Í∏∞</button>
      </form>
  
      <div id="guestbook-list" class="guestbook-list"></div>
  
    </div>

  </section>



</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
  getFirestore,
  collection, addDoc, serverTimestamp, query, orderBy, onSnapshot,
  doc, setDoc, updateDoc, increment, getDoc
}
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_I1Fq7WVZISyompqXL2_GmVa5CCUgSaI",
  authDomain: "sj-guestbook.firebaseapp.com",
  projectId: "sj-guestbook",
  storageBucket: "sj-guestbook.firebasestorage.app",
  messagingSenderId: "918190136782",
  appId: "1:918190136782:web:f90b654849b826e0545f9f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("guestbook-form");
const nameInput = document.getElementById("gb-name");
const msgInput = document.getElementById("gb-message");
const list = document.getElementById("guestbook-list");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = nameInput.value.trim();
  const message = msgInput.value.trim();
  if (!name || !message) return;

  await addDoc(collection(db, "guestbook"), {
    name,
    message,
    createdAt: serverTimestamp()
  });

  nameInput.value = "";
  msgInput.value = "";
});

const q = query(collection(db, "guestbook"), orderBy("createdAt", "desc"));

onSnapshot(q, (snapshot) => {
  list.innerHTML = "";

  snapshot.forEach((doc) => {
    const data = doc.data();

    const item = document.createElement("div");
    item.className = "gb-item";
    item.innerHTML = `
      <div class="gb-meta">${escapeHtml(data.name)}</div>
      <div class="gb-message">${escapeHtml(data.message)}</div>
    `;
    list.appendChild(item);
  });
});

function escapeHtml(str){
  return str
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

// =======================
// ‚ù§Ô∏è HEART COUNTER (GLOBAL)
// =======================
const heartBtn = document.getElementById("heart-btn");
const heartCountEl = document.getElementById("heart-count");

// Ïπ¥Ïö¥ÌÑ∞ Î¨∏ÏÑú ÏúÑÏπò(ÌïòÎÇòÎ°ú Í≥†Ï†ï)
const heartDocRef = doc(db, "counters", "hearts");

// 1) Ï≤òÏùåÏóê Î¨∏ÏÑúÍ∞Ä ÏóÜÏùÑ ÏàòÎèÑ ÏûàÏúºÎãà 0ÏúºÎ°ú ÎßåÎì§Ïñ¥ÎëêÍ∏∞(mergeÎùº ÏïàÏ†Ñ)
const heartSnap = await getDoc(heartDocRef);
if (!heartSnap.exists()) {
  await setDoc(heartDocRef, { count: 0 }); // Ï≤òÏùå 1Î≤àÎßå ÏÉùÏÑ±
}
// 2) Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ïπ¥Ïö¥Ìä∏ ÏùΩÏñ¥ÏÑú ÌôîÎ©¥Ïóê ÌëúÏãú
onSnapshot(heartDocRef, (snap) => {
  const data = snap.data();
  heartCountEl.textContent = data?.count ?? 0;
});

// 3) Î≤ÑÌäº ÎàÑÎ•¥Î©¥ count +1 (ÏõêÏûêÏ†Å Ï¶ùÍ∞Ä)
heartBtn.addEventListener("click", async () => {
  // Îπ†Î•¥Í≤å Ïó∞ÌÉÄÌï¥ÎèÑ incrementÎäî ÏïàÏ†ÑÌïòÍ≤å ÎàÑÏ†ÅÎê®
  await updateDoc(heartDocRef, { count: increment(1) });

  // ÎàåÎ†ÄÏùÑ Îïå ÏÇ¥Ïßù ÌäïÍ∏∞Îäî Î™®ÏÖò(ÏòµÏÖò)
  heartBtn.classList.remove("pop");
  void heartBtn.offsetWidth;
  heartBtn.classList.add("pop");
});
</script>

</body>
</html>
