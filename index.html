<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SJ-Website</title>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #f2f2f2;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 32px;
    }

    .frame {
      width: min(1750px, 100%);
      height: 80vh;
      max-height: 850px;
      background: #fff;
      padding: 16px;

      grid-template-columns: 2fr 1fr;
      display: grid;
      gap: 20px;
    }

    .main-area{
      border: 1px solid rgb(197, 197, 197);
      padding: 16px;
    }
    .guest-area{
      border: 1px solid rgb(197, 197, 197);
      padding: 16px;
      overflow: auto;
    }
    @media (max-width: 768px) {
      body { padding: 16px; align-items: flex-start; }

      .frame{
        height: auto;
        max-height: none;
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
      }
    }

    .profile-box {
      width: 100%;
      max-width: 340px;
      border: 1px solid rgb(197,197,197);
      padding: 20px;
      margin: 0;
    }

    .timetable-box{
      width: 100%;
      max-width: 340px;
      border: 1px solid rgb(197,197,197);
      padding: 20px;
      margin: 0;
      text-align: center;
    }

    .profile-img {
      width: 100%;
      height: auto;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      border-radius: 12px;
      display: block;
      margin: 0 auto 14px;
    }

    .timetable-img{
      width: 100%;
      height: auto;
      object-fit: contain;
      border-radius: 12px;
      display: block;
      margin: 0 0 14px;
    }

    .links-box{
      border: 1px solid rgb(197, 197, 197);
      padding: 16px;
      margin-top: 16px;
    }
    .links-box h3{
      margin: 0 0 12px;
      font-size: 16px;
    }
    .links-grid{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .link-btn{
      display: block;
      border: 1px solid #ccc;
      padding: 12px;
      text-decoration: none;
      color: #111;
      background: #fff;

      width: 100px;
      margin: 0 auto;
      text-align: center;

      transition: all 0.15s ease;
    }

    .link-btn:hover{
      background:#f5f5f5;
    }

    .link-btn:active{
      transform: scale(0.92);
      background:#eaeaea;
    }

    .content-box {
      flex: 1;
      border: 1px solid rgb(197,197,197);
      padding: 20px;
      box-sizing: border-box;
    }

    .guestbook-form {
      display: grid;
      gap: 10px;
      margin-bottom: 16px;
    }

    .guestbook-form input,
    .guestbook-form textarea {
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 14px;
      font-family: inherit;
    }

    .guestbook-form textarea {
      min-height: 90px;
    }

    .guestbook-form button {
      width: 120px;
      padding: 10px;
      cursor: pointer;
    }

    .guestbook-list {
      display: grid;
      gap: 10px;
    }

    .gb-item {
      border: 1px solid #ddd;
      padding: 12px;
    }

    .gb-meta {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }
    .like-box{
      display:flex;
      align-items:center;
      gap:12px;
      margin-top:16px;
    }

    #like-btn{
      border:1px solid #ccc;
      background:#fff;
      padding:10px 14px;
      cursor:pointer;
      border-radius:10px;
      transition:transform .12s ease, background .12s ease;
      box-shadow:0 2px 0 #ccc;
    }

    #like-btn:hover{ background:#f5f5f5; }
    #like-btn:active{
      transform:translateY(2px);
      box-shadow:0 0 0 #ccc;
    }

    #like-count{
      font-size:16px;
      font-weight:600;
    }
  </style>
</head>

<body>

<div class="frame">
  <section class="main-area">
    <div class="profile-box">
      <img src="./IMG_5995.jpeg" class="profile-img">
      <h2>Sujung</h2>
      <p>Webpage testing Lab</p>
    </div>

    <div class="timetable-box">
      <img src="./IMG_6150.jpeg" class="timetable-img">
    </div>

    <section class="introduction-box">
      <p>ì•ˆë…•í•˜ì„¸ì—¬ ê·¸ëƒ¥ ë§Œë“¤ì–´ë³´ê³ ì´ì¨ì—¼ ë¬´ì¡°ê±´ì ì¸ ì¹­ì°¬ê³¼ ì§€ì§€ ë¶€íƒë“œë¦½ë‹ˆë‹¹ í›ˆìˆ˜ ë“±ë“± ì•ˆë°›ìŒ ğŸ˜†ğŸ˜†</p>
    </section>

    <section class="like-box">
      <button id="like-btn" type="button">ğŸ’— í•˜íŠ¸</button>
      <span id="like-count">0</span>
    </section>

    <section class="links-box">
      <div class="links-grid">
        <a class="link-btn" href="https://github.com/sujungww" target="_blank" rel="noopener">GitHub</a>
        <a class="link-btn" href="https://music.apple.com/profile/muniverse" target="_blank" rel="noopener">AppleMusic</a>
        <a class="link-btn" href="https://www.instagram.com/enyvarse?igsh=Z2tjZHpwZXlqZnBh&utm_source=qr" target="_blank" rel="noopener">Insta</a>
        <a class="link-btn" href="https://blog.naver.com/sujung1ch" target="_blank" rel="noopener">Blog</a>
      </div>
    </section>

  </section>

  <section class="guest-area">
    <div class="content-box">
  
      <h2>ë°©ëª…ë¡</h2>
  
      <form id="guestbook-form" class="guestbook-form">
        <input id="gb-name" type="text" maxlength="20" placeholder="ì´ë¦„" required>
        <textarea id="gb-message" maxlength="200" placeholder="ë©”ì‹œì§€" required></textarea>
        <button type="submit">ë“±ë¡</button>
      </form>
  
      <div id="guestbook-list" class="guestbook-list"></div>
  
    </div>

  </section>



</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
  getFirestore,
  collection, addDoc, serverTimestamp, query, orderBy, onSnapshot,
  doc, setDoc, updateDoc, increment
}
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_I1Fq7WVZISyompqXL2_GmVa5CCUgSaI",
  authDomain: "sj-guestbook.firebaseapp.com",
  projectId: "sj-guestbook",
  storageBucket: "sj-guestbook.firebasestorage.app",
  messagingSenderId: "918190136782",
  appId: "1:918190136782:web:f90b654849b826e0545f9f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("guestbook-form");
const nameInput = document.getElementById("gb-name");
const msgInput = document.getElementById("gb-message");
const list = document.getElementById("guestbook-list");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = nameInput.value.trim();
  const message = msgInput.value.trim();
  if (!name || !message) return;

  await addDoc(collection(db, "guestbook"), {
    name,
    message,
    createdAt: serverTimestamp()
  });

  nameInput.value = "";
  msgInput.value = "";
});

const q = query(collection(db, "guestbook"), orderBy("createdAt", "desc"));

onSnapshot(q, (snapshot) => {
  list.innerHTML = "";

  snapshot.forEach((doc) => {
    const data = doc.data();

    const item = document.createElement("div");
    item.className = "gb-item";
    item.innerHTML = `
      <div class="gb-meta">${escapeHtml(data.name)}</div>
      <div>${escapeHtml(data.message)}</div>
    `;
    list.appendChild(item);
  });
});

function escapeHtml(str){
  return str
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

// =======================
// â¤ï¸ HEART COUNTER (GLOBAL)
// =======================
const heartBtn = document.getElementById("heart-btn");
const heartCountEl = document.getElementById("heart-count");

// ì¹´ìš´í„° ë¬¸ì„œ ìœ„ì¹˜(í•˜ë‚˜ë¡œ ê³ ì •)
const heartDocRef = doc(db, "counters", "hearts");

// 1) ì²˜ìŒì— ë¬¸ì„œê°€ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ 0ìœ¼ë¡œ ë§Œë“¤ì–´ë‘ê¸°(mergeë¼ ì•ˆì „)
await setDoc(heartDocRef, { count: 0 }, { merge: true });

// 2) ì‹¤ì‹œê°„ìœ¼ë¡œ ì¹´ìš´íŠ¸ ì½ì–´ì„œ í™”ë©´ì— í‘œì‹œ
onSnapshot(heartDocRef, (snap) => {
  const data = snap.data();
  heartCountEl.textContent = data?.count ?? 0;
});

// 3) ë²„íŠ¼ ëˆ„ë¥´ë©´ count +1 (ì›ìì  ì¦ê°€)
heartBtn.addEventListener("click", async () => {
  // ë¹ ë¥´ê²Œ ì—°íƒ€í•´ë„ incrementëŠ” ì•ˆì „í•˜ê²Œ ëˆ„ì ë¨
  await updateDoc(heartDocRef, { count: increment(1) });

  // ëˆŒë €ì„ ë•Œ ì‚´ì§ íŠ•ê¸°ëŠ” ëª¨ì…˜(ì˜µì…˜)
  heartBtn.classList.remove("pop");
  void heartBtn.offsetWidth;
  heartBtn.classList.add("pop");
});
</script>

</body>
</html>
